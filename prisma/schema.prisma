generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(EXECUTIVE)
  createdAt DateTime @default(now())
}

enum Role {
  ADMIN
  MANAGER
  EXECUTIVE
}

enum LeadBudget {
  LT_1_LAKH // < 1 lakh
  BETWEEN_1_3L // 1â€“3 lakhs
  GT_3_LAKH // > 3 lakhs
}

enum LeadStatus {
  NEW
  CONTACTED
  QUOTATION_SENT
  CLOSED
  LOST
}

enum FollowupStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  NOT_INTERESTED
}

enum QuotationStatus {
  DRAFT
  SENT
  APPROVED
}

enum ProjectStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PAID
  PENDING
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CASH
  UPI
  BANK_TRANSFER
  CARD
  OTHER
}

model Lead {
  id             String         @id @default(uuid())
  name           String
  mobile         String         @db.VarChar(20)
  email          String?        @db.VarChar(255)
  whatsapp       String?        @db.VarChar(20)
  technology     String
  receivedDate   DateTime
  leadSource     String
  followupStatus FollowupStatus
  followupDate   DateTime?
  budget         LeadBudget
  leadStatus     LeadStatus
  description    String?

  quotations Quotation[]
  followups  FollowUp[]
  projects   Project[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([mobile])
}

model Quotation {
  id        String          @id @default(uuid())
  refNo     String          @unique
  subject   String
  pdfUrl    String?
  status    QuotationStatus @default(DRAFT)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  leadId String
  lead   Lead   @relation(fields: [leadId], references: [id])
}

model FollowUp {
  id               Int            @id @default(autoincrement())
  leadId           String
  followupDate     DateTime
  status           FollowupStatus
  notes            String?
  nextFollowupDate DateTime?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  lead Lead @relation(fields: [leadId], references: [id])

  @@unique([leadId, followupDate])
}

model Project {
  id          Int           @id @default(autoincrement())
  name        String
  leadId      String
  startDate   DateTime?
  endDate     DateTime?
  status      ProjectStatus @default(NOT_STARTED)
  totalAmount Float         @default(0)
  description String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  lead     Lead      @relation(fields: [leadId], references: [id])
  payments Payment[]
}

model Payment {
  id        Int           @id @default(autoincrement())
  projectId Int
  date      DateTime
  amount    Float
  method    PaymentMethod
  status    PaymentStatus @default(PAID)
  reference String?
  notes     String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  project Project @relation(fields: [projectId], references: [id])
}
